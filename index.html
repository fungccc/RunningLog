<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running Log Cloud - é›²ç«¯è·‘è€…æ—¥èªŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #0d6efd; --bg: #f4f6f9; }
        body { background-color: var(--bg); font-family: "Microsoft JhengHei", system-ui, sans-serif; padding-bottom: 80px; }
        .card { border: none; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .race-tag { background-color: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        .train-tag { background-color: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; }
        .fab-btn {
            position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px;
            border-radius: 50%; box-shadow: 0 4px 15px rgba(13, 110, 253, 0.4);
            font-size: 24px; z-index: 1000; display: flex; align-items: center; justify-content: center;
        }
        .login-cover {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0d6efd, #0099ff);
            z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;
        }
        .modal-header { border-bottom: none; }
        .loading-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8);
            z-index: 3000; display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div id="app">
    <div v-if="globalLoading" class="loading-overlay">
        <div class="spinner-border text-primary" role="status"></div>
    </div>

    <div v-if="!user" class="login-cover">
        <h1 class="mb-4"><i class="fa-solid fa-person-running"></i> Running Log Cloud</h1>
        <p class="mb-5 opacity-75">ç´€éŒ„ä½ çš„æ¯ä¸€æ­¥ï¼Œå‚™ä»½ä½ çš„åŠªåŠ›</p>
        <button class="btn btn-light btn-lg px-5 shadow" @click="googleLogin">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" class="me-2">
            ä½¿ç”¨ Google ç™»å…¥
        </button>
    </div>

    <div v-else class="container py-3">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0 fw-bold text-primary">
                <i class="fa-solid fa-person-running"></i> {{ user.displayName }}
            </h4>
            <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    è¨­å®š
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#" @click="forceBackupCheck">ğŸ“¥ æ‰‹å‹•å‚™ä»½è³‡æ–™</a></li>
                    <li><a class="dropdown-item" href="#" @click="currentView='nutrition'">ğŸ’Š è£œçµ¦å“è³‡æ–™åº«</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="#" @click="logout">ç™»å‡º</a></li>
                </ul>
            </div>
        </div>

        <div v-if="currentView === 'nutrition'">
            <div class="d-flex justify-content-between mb-3">
                <h5>è£œçµ¦å“ç®¡ç†</h5>
                <button class="btn btn-sm btn-secondary" @click="currentView='dashboard'">è¿”å›æ—¥èªŒ</button>
            </div>
            <div class="alert alert-info">è£œçµ¦å“è³‡æ–™åº«åŠŸèƒ½é–‹ç™¼ä¸­... (å‚™ä»½åŠŸèƒ½å·²æ”¯æ´æ­¤è³‡æ–™åº«)</div>
        </div>

        <div v-else>
            <div class="row g-2 mb-3">
                <div class="col">
                    <input type="text" v-model="filters.keyword" class="form-control form-control-sm" placeholder="ğŸ” æœå°‹åç¨±/åœ°é»">
                </div>
                <div class="col-auto">
                    <select v-model="filters.type" class="form-select form-select-sm">
                        <option value="all">å…¨éƒ¨é¡å‹</option>
                        <option value="race">è³½äº‹</option>
                        <option value="training">è¨“ç·´</option>
                    </select>
                </div>
            </div>

            <div v-if="activities.length === 0" class="text-center text-muted py-5">
                <i class="fa-regular fa-folder-open fa-3x mb-3"></i>
                <p>å°šç„¡ç´€éŒ„ï¼Œé»æ“Šå³ä¸‹è§’ã€Œ+ã€é–‹å§‹ç´€éŒ„</p>
            </div>

            <div v-for="act in filteredActivities" :key="act.id" class="card" @click="editActivity(act)">
                <div class="card-body py-3">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <span class="badge" :class="act.type === 'race' ? 'race-tag' : 'train-tag'">
                            {{ act.type === 'race' ? 'è³½äº‹' : 'è¨“ç·´' }}
                        </span>
                        <small class="text-muted">{{ act.date }}</small>
                    </div>
                    <h5 class="card-title fw-bold mb-1">{{ act.name }}</h5>
                    <div class="card-text small text-secondary">
                        <span v-if="act.distanceKm"><i class="fa-solid fa-ruler-horizontal"></i> {{ act.distanceInputValue }} {{ act.distanceInputUnit }}</span>
                        <span v-if="act.duration" class="ms-3"><i class="fa-regular fa-clock"></i> {{ act.duration }}</span>
                        <span v-if="act.rpe" class="ms-3">RPE: {{ act.rpe }}</span>
                    </div>
                    <div v-if="act.note" class="mt-2 text-muted small border-top pt-2 text-truncate">
                        {{ act.note }}
                    </div>
                </div>
            </div>
        </div>

        <button class="btn btn-primary fab-btn" @click="openAddModal">
            <i class="fa-solid fa-plus"></i>
        </button>
    </div>

    <div class="modal fade" id="activityModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title">{{ isEditMode ? 'ç·¨è¼¯ç´€éŒ„' : 'æ–°å¢ç´€éŒ„' }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="saveActivity">
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label">é¡å‹</label>
                                <select v-model="form.type" class="form-select">
                                    <option value="training">æ—¥å¸¸è¨“ç·´</option>
                                    <option value="race">æ­£å¼è³½äº‹</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label">æ—¥æœŸ</label>
                                <input type="date" v-model="form.date" class="form-control" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">åç¨±</label>
                                <input type="text" v-model="form.name" class="form-control" :placeholder="form.type==='race'?'ä¾‹å¦‚: 2025 å°åŒ—é¦¬æ‹‰æ¾':'ä¾‹å¦‚: é–“æ­‡è·‘ 800m x 10'" required>
                            </div>
                        </div>

                        <div class="p-3 bg-light rounded mb-3">
                            <div class="row g-2 align-items-end">
                                <div class="col-4">
                                    <label class="form-label small">è·é›¢æ•¸å€¼</label>
                                    <input type="number" step="0.01" v-model="form.distanceInputValue" class="form-control">
                                </div>
                                <div class="col-3">
                                    <label class="form-label small">å–®ä½</label>
                                    <select v-model="form.distanceInputUnit" class="form-select">
                                        <option value="km">km</option>
                                        <option value="m">m</option>
                                        <option value="mi">mi</option>
                                    </select>
                                </div>
                                <div class="col-5">
                                    <label class="form-label small">ç¸½è€—æ™‚</label>
                                    <div class="input-group">
                                        <input type="number" v-model="form.durH" class="form-control" placeholder="æ™‚">
                                        <span class="input-group-text">:</span>
                                        <input type="number" v-model="form.durM" class="form-control" placeholder="åˆ†">
                                        <span class="input-group-text">:</span>
                                        <input type="number" v-model="form.durS" class="form-control" placeholder="ç§’">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="form.type === 'race'" class="mb-3 border p-3 rounded border-warning bg-warning bg-opacity-10">
                            <h6 class="text-warning-emphasis fw-bold">ğŸ† è³½äº‹è©³æƒ…</h6>
                            <div class="row g-2">
                                <div class="col-6"><label class="small">å¤§æœƒæ™‚é–“ (Official)</label><input type="text" v-model="form.raceOfficialTime" class="form-control form-control-sm" placeholder="hh:mm:ss"></div>
                                <div class="col-6"><label class="small">æ™¶ç‰‡æ™‚é–“ (Chip)</label><input type="text" v-model="form.raceChipTime" class="form-control form-control-sm" placeholder="hh:mm:ss"></div>
                                <div class="col-4"><label class="small">ç¸½æ’å</label><input type="text" v-model="form.rankOverall" class="form-control form-control-sm"></div>
                                <div class="col-4"><label class="small">å¤©æ°£</label><input type="text" v-model="form.weather" class="form-control form-control-sm"></div>
                                <div class="col-4"><label class="small">å ±åè²»</label><input type="text" v-model="form.fee" class="form-control form-control-sm"></div>
                            </div>
                        </div>

                        <div v-if="form.type === 'training'" class="mb-3">
                            <label class="form-label">å¼·åº¦è‡ªè¦º (RPE 1-10)</label>
                            <input type="range" class="form-range" min="1" max="10" v-model="form.rpe">
                            <div class="d-flex justify-content-between small text-muted"><span>1 (è¼•é¬†)</span><span>{{ form.rpe }}</span><span>10 (æ¥µé™)</span></div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">å‚™è¨» / å¿ƒå¾—</label>
                            <textarea v-model="form.note" class="form-control" rows="3"></textarea>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">ğŸ’¾ å„²å­˜</button>
                            <button v-if="isEditMode" type="button" class="btn btn-outline-danger" @click="deleteActivity">ğŸ—‘ï¸ åˆªé™¤</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="backupModal" data-bs-backdrop="static" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">ğŸ“… æ¯æœˆå‚™ä»½æé†’</h5>
                </div>
                <div class="modal-body">
                    <p>é€™æ˜¯æ‚¨æœ¬æœˆ ({{ currentYearMonth }}) ç¬¬ä¸€æ¬¡ç™»å…¥ã€‚</p>
                    <p>å»ºè­°å‚™ä»½æ‚¨çš„è·‘æ­¥ç´€éŒ„èˆ‡è£œçµ¦è³‡æ–™åº«ï¼Œä»¥é˜²è¬ä¸€ã€‚</p>
                    <div class="d-grid gap-2 mt-4">
                        <button class="btn btn-success" @click="performBackup" :disabled="backupProcessing">
                            <span v-if="backupProcessing" class="spinner-border spinner-border-sm"></span>
                            <span v-else><i class="fa-solid fa-file-csv"></i> ç”Ÿæˆä¸¦ä¸‹è¼‰å‚™ä»½ (CSV)</span>
                        </button>
                        <button class="btn btn-link text-secondary text-decoration-none" @click="skipBackup">
                            ç¨å¾Œå†èªª
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // ------------------------------------------------------------------
    // âš ï¸ è¨­å®šå€ï¼šè«‹å°‡ Firebase Console çš„è¨­å®šè¤‡è£½åˆ°é€™è£¡
    // ------------------------------------------------------------------
    const firebaseConfig = {
        apiKey: "AIzaSyCw7o8V-QW5M9Px7lcx4hOCAxW7oNKLhak",
        authDomain: "runninglog-8da12.firebaseapp.com",
        projectId: "runninglog-8da12",
        storageBucket: "runninglog-8da12.firebasestorage.app",
        messagingSenderId: "600035565062",
        appId: "1:600035565062:web:5ae746eadd2b0c6d5c6d87"
    };
    // ------------------------------------------------------------------

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const { createApp } = Vue;

    createApp({
        data() {
            return {
                user: null,
                globalLoading: true,
                backupProcessing: false,
                currentView: 'dashboard',
                activities: [],
                nutritionDb: [], // é ç•™çµ¦å‚™ä»½ç”¨
                filters: { keyword: '', type: 'all' },
                
                // Form Data
                isEditMode: false,
                currentId: null,
                form: this.getEmptyForm(),
                
                // Modal Instances
                actModal: null,
                backupModal: null,

                currentYearMonth: new Date().toISOString().slice(0, 7)
            }
        },
        computed: {
            filteredActivities() {
                return this.activities.filter(act => {
                    const matchKey = (act.name + (act.location||"")).toLowerCase().includes(this.filters.keyword.toLowerCase());
                    const matchType = this.filters.type === 'all' || act.type === this.filters.type;
                    return matchKey && matchType;
                });
            }
        },
        mounted() {
            // åˆå§‹åŒ– Bootstrap Modals
            this.actModal = new bootstrap.Modal(document.getElementById('activityModal'));
            this.backupModal = new bootstrap.Modal(document.getElementById('backupModal'));

            // ç›£è½ç™»å…¥ç‹€æ…‹
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    this.user = user;
                    await this.loadUserData(); // è¼‰å…¥è³‡æ–™
                    await this.checkMonthlyBackup(); // æª¢æŸ¥å‚™ä»½
                } else {
                    this.user = null;
                    this.activities = [];
                }
                this.globalLoading = false;
            });
        },
        methods: {
            // --- ç™»å…¥/ç™»å‡º ---
            async googleLogin() {
                try { await signInWithPopup(auth, provider); } 
                catch (e) { alert("ç™»å…¥å¤±æ•—: " + e.message); }
            },
            async logout() {
                await signOut(auth);
            },

            // --- æ ¸å¿ƒå‚™ä»½é‚è¼¯ ---
            async checkMonthlyBackup() {
                const uid = this.user.uid;
                const userDocRef = doc(db, "users", uid);
                const userSnap = await getDoc(userDocRef);
                const now = new Date();

                let lastBackup = null;

                if (userSnap.exists()) {
                    const data = userSnap.data();
                    lastBackup = data.lastBackupMonth;
                    // æ›´æ–°æœ€å¾Œç™»å…¥æ™‚é–“
                    await updateDoc(userDocRef, { lastLoginAt: serverTimestamp() });
                } else {
                    // æ–°ç”¨æˆ¶ï¼Œå»ºç«‹æª”æ¡ˆ
                    await setDoc(userDocRef, { 
                        createdAt: serverTimestamp(),
                        lastLoginAt: serverTimestamp(),
                        email: this.user.email
                    });
                }

                // åˆ¤æ–·æ˜¯å¦éœ€è¦å‚™ä»½ (æœ¬æœˆå°šæœªå‚™ä»½)
                if (lastBackup !== this.currentYearMonth) {
                    this.backupModal.show();
                }
            },
            async performBackup() {
                this.backupProcessing = true;
                try {
                    // 1. æŠ“å–æ‰€æœ‰è³‡æ–™
                    const uid = this.user.uid;
                    const actRef = collection(db, `users/${uid}/activities`);
                    const nutRef = collection(db, `users/${uid}/nutrition_db`);
                    
                    const [actSnap, nutSnap] = await Promise.all([getDocs(actRef), getDocs(nutRef)]);
                    
                    const acts = actSnap.docs.map(d => ({id: d.id, ...d.data()}));
                    const nuts = nutSnap.docs.map(d => ({id: d.id, ...d.data()}));

                    // 2. è½‰æ› CSV
                    const actCsv = this.convertToCSV(acts);
                    const nutCsv = this.convertToCSV(nuts);

                    // 3. å»ºç«‹æª”æ¡ˆç‰©ä»¶
                    const dateStr = new Date().toISOString().slice(0, 10);
                    const files = [];
                    if(actCsv) files.push(new File([actCsv], `running_activities_${dateStr}.csv`, {type: 'text/csv'}));
                    if(nutCsv) files.push(new File([nutCsv], `nutrition_db_${dateStr}.csv`, {type: 'text/csv'}));

                    // 4. ä¸‹è¼‰æˆ–åˆ†äº«
                    if (navigator.canShare && navigator.canShare({ files })) {
                        try {
                            await navigator.share({
                                title: 'RunningLog Backup ' + dateStr,
                                text: 'æˆ‘çš„è·‘æ­¥ç´€éŒ„å‚™ä»½',
                                files: files
                            });
                        } catch (err) {
                            console.log("Share failed, falling back to download", err);
                            this.downloadFiles(files);
                        }
                    } else {
                        this.downloadFiles(files);
                    }

                    // 5. æ›´æ–° Firestore ç´€éŒ„ (æœ¬æœˆå·²å‚™ä»½)
                    await updateDoc(doc(db, "users", uid), {
                        lastBackupMonth: this.currentYearMonth
                    });

                    this.backupModal.hide();
                    alert("å‚™ä»½å®Œæˆï¼");

                } catch (e) {
                    console.error(e);
                    alert("å‚™ä»½å¤±æ•—: " + e.message);
                } finally {
                    this.backupProcessing = false;
                }
            },
            skipBackup() {
                this.backupModal.hide();
                // é€™è£¡æˆ‘å€‘ä¸æ›´æ–° lastBackupMonthï¼Œæ‰€ä»¥ä¸‹æ¬¡ç™»å…¥é‚„æ˜¯æœƒå•
                // å¦‚æœä½ æƒ³æœ¬æœˆåªå•ä¸€æ¬¡ï¼Œç„¡è«–æ˜¯å¦ä¸‹è¼‰ï¼Œè«‹åœ¨é€™è£¡ä¹ŸåŸ·è¡Œ updateDoc
            },
            forceBackupCheck() {
                // æ‰‹å‹•è§¸ç™¼å‚™ä»½ (å³ä½¿æœ¬æœˆå·²å‚™ä»½)
                this.backupModal.show();
            },

            // --- è¼”åŠ© CSV å·¥å…· ---
            convertToCSV(objArray) {
                if (!objArray || !objArray.length) return null;
                const array = typeof objArray !== 'object' ? JSON.parse(objArray) : objArray;
                
                // æ”¶é›†æ‰€æœ‰å¯èƒ½çš„ headers (å› ç‚º NoSQL æ¬„ä½ä¸å›ºå®š)
                let headers = new Set();
                array.forEach(row => Object.keys(row).forEach(k => headers.add(k)));
                headers = Array.from(headers);

                let str = '\uFEFF' + headers.join(',') + '\r\n'; // BOM for Excel

                for (let i = 0; i < array.length; i++) {
                    let line = '';
                    for (let index in headers) {
                        if (line != '') line += ',';
                        let val = array[i][headers[index]];
                        // è™•ç†å­—ä¸²ä¸­çš„é€—è™Ÿå’Œæ›è¡Œ
                        if (typeof val === 'string') {
                            val = '"' + val.replace(/"/g, '""') + '"';
                        } else if (typeof val === 'object') {
                            val = '"' + JSON.stringify(val).replace(/"/g, '""') + '"';
                        }
                        line += val === undefined ? '' : val;
                    }
                    str += line + '\r\n';
                }
                return str;
            },
            downloadFiles(files) {
                files.forEach(file => {
                    const link = document.createElement("a");
                    link.href = URL.createObjectURL(file);
                    link.download = file.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
            },

            // --- Firestore CRUD ---
            async loadUserData() {
                this.globalLoading = true;
                const q = query(collection(db, `users/${this.user.uid}/activities`), orderBy("date", "desc"));
                const querySnapshot = await getDocs(q);
                this.activities = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                this.globalLoading = false;
            },
            getEmptyForm() {
                return {
                    type: 'training', date: new Date().toISOString().slice(0, 10),
                    name: '', distanceInputValue: '', distanceInputUnit: 'km',
                    durH: '', durM: '', durS: '', rpe: 5, note: '',
                    // Race specific
                    raceOfficialTime: '', raceChipTime: '', rankOverall: '', weather: '', fee: ''
                };
            },
            openAddModal() {
                this.isEditMode = false;
                this.form = this.getEmptyForm();
                this.actModal.show();
            },
            editActivity(act) {
                this.isEditMode = true;
                this.currentId = act.id;
                // è§£ææ™‚é–“å›å¡«
                let h='', m='', s='';
                if(act.duration) {
                    const parts = act.duration.split(':');
                    h=parts[0]; m=parts[1]; s=parts[2];
                }
                this.form = { ...act, durH: h, durM: m, durS: s };
                this.actModal.show();
            },
            async saveActivity() {
                const uid = this.user.uid;
                
                // è¨ˆç®—é¡¯ç¤ºç”¨æ•¸æ“š
                const formattedTime = (this.form.durH||'0') + ':' + (this.form.durM||'00').toString().padStart(2,'0') + ':' + (this.form.durS||'00').toString().padStart(2,'0');
                
                // è·é›¢æ›ç®— (çµ±ä¸€å­˜ km æ–¹ä¾¿è¨ˆç®—ï¼Œä½†ä¹Ÿä¿ç•™åŸå§‹è¼¸å…¥)
                let distKm = 0;
                const val = parseFloat(this.form.distanceInputValue);
                if(val) {
                    if(this.form.distanceInputUnit === 'km') distKm = val;
                    else if(this.form.distanceInputUnit === 'm') distKm = val / 1000;
                    else if(this.form.distanceInputUnit === 'mi') distKm = val * 1.60934;
                }

                const payload = {
                    ...this.form,
                    duration: formattedTime,
                    distanceKm: distKm,
                    updatedAt: serverTimestamp()
                };

                // ç§»é™¤ UI ç”¨çš„æš«å­˜æ¬„ä½
                delete payload.durH; delete payload.durM; delete payload.durS;

                try {
                    if (this.isEditMode) {
                        await updateDoc(doc(db, `users/${uid}/activities`, this.currentId), payload);
                    } else {
                        payload.createdAt = serverTimestamp();
                        await addDoc(collection(db, `users/${uid}/activities`), payload);
                    }
                    this.actModal.hide();
                    this.loadUserData(); // é‡æ–°æ•´ç†
                } catch (e) {
                    alert("å„²å­˜éŒ¯èª¤: " + e.message);
                }
            },
            async deleteActivity() {
                if(!confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ")) return;
                try {
                    await deleteDoc(doc(db, `users/${this.user.uid}/activities`, this.currentId));
                    this.actModal.hide();
                    this.loadUserData();
                } catch(e) { alert("åˆªé™¤å¤±æ•—"); }
            }
        }
    }).mount('#app');
</script>
</body>
</html>
