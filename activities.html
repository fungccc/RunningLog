<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running Log - æ´»å‹•æ—¥èªŒ</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  // åˆå§‹åŒ–æ‰‹æ©Ÿç‰ˆ Debug Console
  var vConsole = new VConsole();
</script>
</head>
<body>
    <div id="app" v-cloak>
        <nav class="navbar">
            <div class="logo">Running Log</div>
            <div class="nav-links">
                <a href="activities.html" class="active">æ´»å‹•æ—¥èªŒ</a>
                <a href="nutrition.html">è£œçµ¦è³‡æ–™åº«</a>
                <a href="#" @click="logout">ç™»å‡º</a>
            </div>
        </nav>

        <div class="container">
            <div class="stats-grid">
                <div class="card stat-card">
                    <h3>æœ¬æœˆç¸½è·‘é‡</h3>
                    <div class="value">{{ monthlyStats.totalKm.toFixed(1) }} <span class="unit">km</span></div>
                </div>
                <div class="card stat-card">
                    <h3>æ¯”è³½</h3>
                    <div class="value">{{ monthlyStats.raceCount }} <span class="unit">å ´</span></div>
                </div>
                <div class="card stat-card">
                    <h3>è¨“ç·´</h3>
                    <div class="value">{{ monthlyStats.trainingCount }} <span class="unit">æ¬¡</span></div>
                </div>
            </div>

<div class="controls">
    <div class="filters">
        <input type="month" v-model="filters.month">
        <select v-model="filters.type">
            <option value="all">å…¨éƒ¨é¡å‹</option>
            <option value="race">æ¯”è³½</option>
            <option value="training">è¨“ç·´</option>
        </select>
    </div>
    <div class="actions">
        <button @click="openModal('training')" class="btn secondary">æ–°å¢è¨“ç·´</button>
        <button @click="openModal('race')" class="btn primary">æ–°å¢æ¯”è³½</button>
        <button @click="exportCSV" class="btn outline">åŒ¯å‡º</button>
        
        <label class="btn outline file-btn" style="border: 1px dashed #666; cursor: pointer;">
            ğŸ“‚ åŒ¯å…¥ CSV (Garmin/èˆŠç´€éŒ„)
            <input type="file" @change="handleImport" accept=".csv" hidden>
        </label>
    </div>
</div>

<div class="activity-list">
    <div v-for="act in filteredActivities" :key="act.id" class="card activity-card" :class="act.type">
        <div class="act-header">
            <div class="act-title-group">
                <span class="date">{{ act.date }}</span>
                <span class="badge" :class="act.type">
                    {{ act.type === 'race' ? (act.raceNameZh || act.raceName) : act.workoutTitle }}
                </span>
            </div>
            <button @click="editActivity(act)" class="btn sm outline" style="padding: 2px 8px; font-size: 0.8rem;">âœï¸ ç·¨è¼¯</button>
        </div>
        
        <div class="act-meta">
             <span v-if="act.distanceKm" style="font-weight:bold; color:#2563eb; margin-right:10px;">{{ act.distanceKm }} km</span>
             <span v-if="act.durationSec" style="color:#64748b;">â± {{ formatDuration(act.durationSec) }}</span>
        </div>

        <div class="act-details">
            <p v-if="act.locationName">ğŸ“ {{ act.locationName }}</p>
            <p v-if="act.note" class="note" style="white-space: pre-wrap;">{{ act.note }}</p>
            <div v-if="act.type === 'training' && act.workoutCategories" class="tags">
                <span v-for="tag in act.workoutCategories" class="tag">{{ tag }}</span>
            </div>
        </div>
    </div>
</div>


        <div v-if="showModal" class="modal-overlay">
            <div class="modal">
                <h2>{{ isEdit ? 'ç·¨è¼¯' : 'æ–°å¢' }} {{ form.type === 'race' ? 'æ¯”è³½' : 'è¨“ç·´' }}</h2>
                <form @submit.prevent="saveActivity">
                    <div class="form-group">
                        <label>æ—¥æœŸ</label>
                        <input type="date" v-model="form.date" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>è·é›¢</label>
                            <input type="number" step="0.01" v-model.number="form.distanceInputValue">
                            <select v-model="form.distanceInputUnit">
                                <option value="km">km</option>
                                <option value="m">m</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æ™‚é–“ (æ™‚:åˆ†:ç§’)</label>
                            <div class="time-inputs">
                                <input type="number" placeholder="HH" v-model.number="form.timeH">
                                <input type="number" placeholder="MM" v-model.number="form.timeM">
                                <input type="number" placeholder="SS" v-model.number="form.timeS">
                            </div>
                        </div>
                    </div>

                    <div v-if="form.type === 'race'" class="race-fields">
                        <div class="form-group">
                            <label>è³½äº‹åç¨± (ä¸­)</label>
                            <input type="text" v-model="form.raceNameZh">
                        </div>
                        </div>

                    <div v-if="form.type === 'training'" class="training-fields">
                        <div class="form-group">
                            <label>è¨“ç·´æ¨™é¡Œ</label>
                            <input type="text" v-model="form.workoutTitle" placeholder="ä¾‹å¦‚: Tempo 10K">
                        </div>
                        <div class="form-group">
                            <label>è¨“ç·´é¡å‹ (å¤šé¸)</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" value="easyRun" v-model="form.workoutCategories"> Easy Run</label>
                                <label><input type="checkbox" value="tempoRun" v-model="form.workoutCategories"> Tempo</label>
                                <label><input type="checkbox" value="intervals" v-model="form.workoutCategories"> é–“æ­‡</label>
                                <label><input type="checkbox" value="longRun" v-model="form.workoutCategories"> LSD</label>
                                <label><input type="checkbox" value="strength" v-model="form.workoutCategories"> è‚ŒåŠ›</label>
                                <label><input type="checkbox" value="recovery" v-model="form.workoutCategories"> æ¢å¾©</label>
                            </div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" @click="showModal = false" class="btn">å–æ¶ˆ</button>
                        <button type="submit" class="btn primary">å„²å­˜</button>
                    </div>
                </form>
            </div>
        </div>

        <div v-if="showBackupModal" class="modal-overlay">
            <div class="modal">
                <h3>ğŸ”” æ¯æœˆå‚™ä»½æé†’</h3>
                <p>é€™æ˜¯æ‚¨æœ¬æœˆç¬¬ä¸€æ¬¡ç™»å…¥ï¼Œå»ºè­°å‚™ä»½è³‡æ–™ã€‚</p>
                <div class="modal-actions">
                    <button @click="skipBackup" class="btn">æœ¬æœˆä¸å†æé†’</button>
                    <button @click="performBackup" class="btn primary">ä¸‹è¼‰å‚™ä»½ CSV</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/app-activities.js"></script>
</body>
</html>
